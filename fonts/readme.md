# BDFフォント変換

```aaa
Copyright (C) 2020 Mono Wireless Inc. All Rights Reserved.
Released under MW-OSSLA-1J,1E (MONO WIRELESS OPEN SOURCE SOFTWARE LICENSE AGREEMENT).
```



本スクリプトは、BDF フォントデータを C++ ソース形式に変換します。文字セットを最小化するため、



## 生成されるフォント配列

[シングル幅フォント]

* font_???r[]
  U+0000-U+007F (アスキー文字列) 

* font_???r_latin1ex[]
  U+0080-U+00FF (latin 拡張文字列)

* font_???r_jisx201[] 
  U+FF60-U+FFAF (半角カナ)



[ダブル幅フォント]

* font_???k_data[]
  ダブル幅フォントのデータ（コード昇順、１ライン2バイト、ライン数分並ぶ）
* font_???k_idx[]
  ダブル幅フォントの文字コードテーブル (インデックスNの文字コードは idx[N] で与えられる)

収録文字数に応じて、最小(アプリケーションで使用する最小文字群＋記号や仮名文字等・std(常用文字を収録)・full(日本語の文字セットを一通り収録)の３種類を出力します。



## スクリプトの実行環境

以下を実行できる環境が必要です。

* bash および基本ツール群

* python3

* gcc, g++ (プリプロセッサを動作させるため)

  ソース中のコメント行を除外するため```gcc -E -fpreprocessed``` を実行しています。実行環境で不都合がある場合は適宜コマンドを調整してください。



## 使用法

1. .../fonts をカレントディレクトリとしておく。
2. 強制的に追加したい文字がある場合は ```MakeKTbl.mandate```に追記してください。
3. オリジナルの文字を追加する場合は外字テーブル(後述)を編集してください。
4. 以下のコマンドを実行します。
   ```bash ./do_it.sh```
5. 実行後 ```../src/font``` ディレクトリに更新されたフォントソースが追加されます。ビルドを試してください。



## ファイルの解説

| ファイル名             | 解説                                                         |
| ---------------------- | ------------------------------------------------------------ |
| do_it.sh               | 文字コードリストの生成、BDFフォントからC++ソースへの変換を行うシェルスクリプト。 |
| BdfToCppSrc.py         | BDFファイルからC++形式のソースを出力するPython3スクリプト。  |
| jis_to_uni.txt         | JISコードをUnicodeに変換するリスト。スペース区切りのテキストファイル。<br />１番目：JISコード<br />２番目：Unicode(U+は省略) |
| kanjitable_full.txt    | フルセット文字列の文字コードリスト。スペース区切りのUTF-8のテキストファイル。<br />１番目：文字(UTF-8)<br />２番目：JISコード<br />３番目：EUCコード<br />４番目：UNICODE(U+????) |
| kanjitable_joyo.txt    | 常用文字列の文字コードリスト。同上                           |
| kanjitable_kigou.txt   | 記号文字の文字コードリスト。同上（このファイルは使われていません） |
| kanjitable_missing.txt | 常用文字列の未処理文字コードリスト。同上（このファイルは使われていません） |
| kanjitable_std.txt     | 常用文字列＋追加的に使用する文字群の文字コードリスト。同上（このファイルはスクリプトにより自動生成されます） |
| kanjitable_minimul.txt | 最小限の文字を含めた文字コードリスト（このファイルはスクリプトにより自動生成されます） |
| MakeKTbl.mandate       | 必須文字列の追加リスト<br />最小セット、stdセットに対して文字を追加したい場合に、必要な文字をこのファイルに追記します。追加したい文字は kanjitable_full.txt に定義されている必要があります。 |
| MakeKTbl.py            | 文字コードテーブルを生成するPython3スクリプト。<br />標準入力から文字列を受け取り、 kanjitable_full.txt に含まれるものを出力します。 |
| MakeKTbl.sh            | 文字コードテーブル（kanjitable_minimu.txt, kanjitable_std.txt) を生成するシェルスクリプト。<br />ソースコード ../examples/\*/\* のダブルバイト文字列(直接記述されていない文字列は無効)を抽出し、MakeTbl.mandate を併せて、kanjitable_full.txt のサブセットを生成します。 |
| MakeKTbl.tmp           | MakeKTbl.sh により生成される中間ファイルで、ソースコード中に発見されたダブルバイト文字列の列挙です。 |
| MakeKTblPre.py         | 標準入力から文字列を受け取り、文字列中のダブルバイト文字列を列挙します。 |
| outdir/                | 出力ソースコードを格納するディレクトリ                       |



## フォントディレクトリ

| ディレクトリ名 |                          |
| -------------- | ------------------------ |
| mplus10        | M+ BITMAP FONTS (10dots) |
| mplus12        | M+ BITMAP FONTS (12dots) |
| shinonome12    | 東雲フォント (12dots)    |
| shinonome14    | 東雲フォント (14dots)    |
| shinonome16    | 東雲フォント (16dots)    |

※ オリジナルの配布ファイルから必要部分のみを収録しています。また一部編集も行っています。



* ???.lic
  ライセンス記述を含めたファイル (C++コメント形式)
* gaiji.bdf
  外字定義ファイル
* config.ini
  スクリプト用設定ファイル (BdfToCppSrc.py)



## 外字 (gaiji.bdf)

外字の定義は BDF ファイルに近い記述を行います。外字は最小,std,fullすべてのセットに含められます。

以下の例では16dotフォントの定義として、文字コード (E000, STARTCHARに10000を付加します) として定義しています。STARTCHAR から ENDCHAR のブロックを必要数列挙します。

```STARTCHAR 1E000
STARTCHAR 1E000
BITMAP
................
................
.@@@@@@@@@@@@@@.
..@..........@..
..@.........@...
...@........@...
...@.......@....
....@......@....
....@.....@.....
.....@...@......
.....@...@......
......@.@.......
......@.@.......
.......@........
.......@........
................
ENDCHAR
STARTCHAR 1E001
BITMAP
................
................
.@@@@@@@@@@@@@@.
..@..........@..
..@...@@@@...@..
...@...@@...@...
...@...@@..@....
....@......@....
....@.....@.....
.....@...@......
.....@...@......
......@.@.......
......@.@.......
.......@........
.......@........
................
ENDCHAR
```